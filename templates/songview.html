<!DOCTYPE html>
<html>
<head><title>ë…¸ë˜ ìƒì„¸</title></head>
<body>
    <nav>
        <h1>Music Log</h1>
        <ul>
            {% if g.user %}
                <li><a href="{{ url_for('profile') }}"><strong>{{ g.user['user_name'] }}</strong></a></li>
                <li><a href="{{ url_for('charts') }}">Charts</a></li>
                <li><a href="{{ url_for('logout') }}">Log Out</a>
            {% else %}
                <li><a href="{{ url_for('register') }}">Register</a>
                <li><a href="{{ url_for('login') }}">Log In</a>
            {% endif %}
        </ul>
    </nav>
    <hr>
    <h2>ğŸ’¿ {{ song['song_name'] }} - ìƒì„¸ ì •ë³´</h2>
    <ul>
        <li><strong>ì•„í‹°ìŠ¤íŠ¸:</strong> <a href="{{ url_for('view_artist', artist_id=song['artist_id']) }}">{{ song['artist_name'] }}</a></li>
        <li><strong>ì•¨ë²”:</strong> <a href="{{ url_for('view_album', album_id=song['album_id']) }}">{{ song['album_name'] }}</a></li>
        <li><strong>ì•¨ë²” ë°œë§¤ì¼:</strong> {{ song['release_date'] }}</li>
        {% if song.song_release_date %}
        <li><strong>ë…¸ë˜ ë°œë§¤ì¼:</strong> {{ song['song_release_date'] }}</li>
        {% endif %}
    </ul>

    {% if stats %}
    <div style="background-color: #f0f0f0; padding: 10px; margin: 10px 0;">
        <h4>ğŸ“Š ì•„í‹°ìŠ¤íŠ¸({{ song['artist_name'] }}) í†µê³„ (í”„ë¡œì‹œì € ì—°ë™)</h4>
        <p>ë³´ìœ  ê³¡ ìˆ˜: {{ stats['p_song_count'] }}ê³¡ / ì‚¬ìš©ì í‰ê·  í‰ì : {{ "%.1f"|format(stats['p_avg_score']|float) }}ì </p>
    </div>
    {% endif %}

    <hr>
    
    {% if g.user %}
        <a href="{{ url_for('add_note', entity_type='song', entity_id=song['id']) }}">[+ ë…¸íŠ¸ ì¶”ê°€]</a>
        <h3 style="margin-top: 20px;">â­ í‰ì  ë‚¨ê¸°ê¸°</h3>
        <form action="{{ url_for('rate_song') }}" method="post">
            <input type="hidden" name="song_id" value="{{ song['id'] }}">
            ì ìˆ˜: 
            <select name="score">
                <option value="5">5ì  (ìµœê³ )</option>
                <option value="4">4ì </option>
                <option value="3">3ì </option>
                <option value="2">2ì </option>
                <option value="1">1ì </option>
            </select><br><br>
            ë¦¬ë·°: <textarea name="review" rows="3"></textarea><br>
            <button type="submit">ë“±ë¡í•˜ê¸°</button>
        </form>
    {% else %}
        <p><a href="{{ url_for('login') }}">ë¡œê·¸ì¸</a>í•˜ì—¬ í‰ì ì´ë‚˜ ë…¸íŠ¸ë¥¼ ë‚¨ê²¨ë³´ì„¸ìš”.</p>
    {% endif %}

    <hr style="margin-top: 20px;">

    <h3>ğŸ“ ë…¸íŠ¸ ëª©ë¡</h3>
    <div id="notes-section">
        {% if notes_with_hashtags %}
            {% for item in notes_with_hashtags %}
                <div style="border: 1px solid #ccc; padding: 10px; margin-bottom: 10px;">
                    <p><strong>ì‘ì„±ì: {{ item.user_name }}</strong> ({{ item.created_at.strftime('%Y-%m-%d') }})</p>
                    <p>{{ item.note|replace('\n', '<br>')|safe }}</p>
                    {% if item.hashtags %}
                        <p style="color: #555;">
                            <strong>í•´ì‹œíƒœê·¸:</strong>
                            {% for tag in item.hashtags.split(',') %}
                                <a href="{{ url_for('view_hashtag', hashtag_name=tag.strip()) }}" style="background-color: #eee; padding: 2px 5px; border-radius: 5px; font-size: 0.9em; text-decoration: none; color: inherit;">#{{ tag.strip() }}</a>
                            {% endfor %}
                        </p>
                    {% endif %}
                </div>
            {% endfor %}
        {% else %}
            <p>ì•„ì§ ì‘ì„±ëœ ë…¸íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
        {% endif %}
    </div>

    <a href="/">[ëª©ë¡ìœ¼ë¡œ]</a>
</body>
</html>